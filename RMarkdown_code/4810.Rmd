---
title: "4810_Project"
author: "Nandar May"
date: "2024-03-19"
output: html_document
---


# Read and Introduce our Dataset
```{r}
star = read.csv('..\\data\\starbucks_drinkMenu_expanded.csv')
head(star)
```
# Data Structure
```{r}
str(star)
```



# Convert column Total.Fat..g. / Vitamin.A....DV./ Vitamin.C....DV. / Calcium....DV./ Iron....DV./Caffeine..mg.  
# from chr to num
```{r}
# Replace all NA values with 0 in the entire dataframe
star[is.na(star)] <- 0
star$Total.Fat..g. = as.numeric(star$Total.Fat..g.)
star$Vitamin.A....DV. = as.numeric(sub("%", "", star$Vitamin.A....DV.))
star$Vitamin.C....DV. = as.numeric(sub("%", "", star$Vitamin.C....DV.))
star$Calcium....DV. = as.numeric(sub("%", "", star$Calcium....DV.))
star$Iron....DV. = as.numeric(sub("%", "", star$Iron....DV.))
star$Caffeine..mg. = as.numeric(sub("%", "", star$Caffeine..mg.))
star[is.na(star)] <- 0
```


# Literature Review
Total Fat (g) - Fat is a dense source of energy, providing about 9 calories per gram. This includes all types of fats such as saturated fats, trans fats, and unsaturated fats.

Total Carbohydrates (g) - Carbohydrates provide about 4 calories per gram. This includes all types of carbohydrates such as sugars, dietary fibers, and starches.

Protein (g) - Protein also provides about 4 calories per gram.


# get all the scatter plot of numerical variables

```{r}
numeric_vars <- sapply(star, is.numeric)
pairs(star[, numeric_vars])

```



# according to drink type, combine some levels of the Beverage category

```{r}
Frappuccino = c('Frappuccino® Blended Coffee','Frappuccino® Blended Crème','Frappuccino® Light Blended Coffee')
Espreeso = c('Classic Espresso Drinks','Coffee','Signature Espresso Drinks')
# others: Shaken Iced Beverages, Tazo® Tea Drinks, Smoothies 
star$Drink.Type = ifelse(star$Beverage_category %in% Frappuccino,'Frappuccino',ifelse(star$Beverage_category %in% Espreeso,'Espreeso','non-coffee'))
```

# boxplot of Calories \~ Drink.Type

```{r}
library(ggplot2)

# Create the boxplot using ggplot
p <- ggplot(data = star, aes(x = Drink.Type, y = Calories,fill = Drink.Type)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  xlab("Beverage Drink.Type") +
  ylab("Calories") +
  scale_fill_brewer(palette = "Set3") # Adds a color palette for the fill colors

p
```

# from literature review, we omit sugar , Dietary.Fibre..g., trans fat, saturated fat, because Total.Fat..g. and Total.Carbohydrates..g. can represent them

# Model selection
```{r}
library(MASS)
MASS::stepAIC(lm(Calories~Total.Fat..g. + 
     Sodium..mg. + Total.Carbohydrates..g. + 
    Cholesterol..mg.  + Protein..g. + 
    Vitamin.A....DV. + Vitamin.C....DV. + Calcium....DV. + Iron....DV. + 
    Caffeine..mg. + Drink.Type,data=star),direction="both")
```
# from the stepAIC, we get model fit1
```{r}
fit1 = lm(formula = Calories ~ Total.Fat..g. + Sodium..mg. + Total.Carbohydrates..g. + 
    Cholesterol..mg. + Protein..g. + Vitamin.C....DV. + Calcium....DV. + 
    Iron....DV. + Drink.Type, data = star)

summary(fit1)

library(car)
car::vif(fit1)
```

# since Total.Carbohydrates..g. and Calcium....DV. ,Protein..g.and reletively high GVIF^(1/(2*Df)). we check their cor
```{r}
cor(star$Total.Carbohydrates..g.,star$Calcium....DV.)

cor(star$Total.Carbohydrates..g.,star$Protein..g.)
```
# fit2 , model without Calcium....DV. , Protein..g.
```{r}
fit2 = lm(formula = Calories ~ Total.Fat..g. + Sodium..mg. + Total.Carbohydrates..g. + 
    Cholesterol..mg. + Vitamin.C....DV.  + 
    Iron....DV. + Drink.Type, data = star)

summary(fit2)

library(car)
car::vif(fit2)
```

# compare fit1, fit2
```{r}
library(lmtest)
lmtest::lrtest(fit2,fit1)
```

```{r}
Anova(fit2)
```

fit3 , model withour Sodium..mg.
```{r}
fit3 = lm(formula = Calories ~ Total.Fat..g.  + Total.Carbohydrates..g. + 
    Cholesterol..mg. + Vitamin.C....DV.  + 
    Iron....DV. + Drink.Type, data = star)

summary(fit3)
```

```{r}
Anova(fit3)
```

# we know that different drink type may have different ingredients. For example, smoothies may have more sugar than classic expresso coffee.
# so we want to know is there interaction between Drink.Type and other explanatory variables

```{r}
var_names = c('Total.Fat..g.'  , 'Total.Carbohydrates..g.' , 'Cholesterol..mg.', 'Vitamin.C....DV.'  , 'Iron....DV.')
for (variable_name in var_names) {
  p = ggplot(star, aes(x = star[[variable_name]], y = Calories)) +
    geom_point(aes(color = Drink.Type)) +  # Color points by Drink.Type
    labs(x = variable_name, y = "Calories", color = "Drink Type")
  print(p)

}
```


# from Scatter plot above, we can find that there seems interaction between Drink type and Total.carbonhydrates; 

#fit4 ,model with interaction between Drink type and Total.carbonhydrates;
```{r}
fit4 = lm(formula = Calories ~ Total.Fat..g.  + Total.Carbohydrates..g. + 
    Cholesterol..mg. + Vitamin.C....DV.  + 
    Iron....DV. + Drink.Type +Drink.Type:Total.Carbohydrates..g., data = star)

summary(fit4)
```
H0: fit3 better, beta_interaction = 0
Ha: fit4 better, beta_interaction != 0
```{r}
lrtest(fit3,fit4)
```
## since lrtest p-value < 0.05,we reject H0, and conclude that model with interaction between Drink type and Total.carbonhydrates is better.
## Also, from R^2 adjusted, it increases 0.32% to 99.6%


